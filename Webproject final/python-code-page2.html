<!doctype html>
<html>
  <head>
      <title>python-code-page2</title>
      <link rel="stylesheet" href="python-code-page-style.css">
  </head>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.14/vue.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js'></script>
  <script>
          $(document).ready(function(){ 
   
      $(".btn-box").on('click', function(){
      $(".comment").addClass("afterText");
    });
    $("textarea").on('keyup.enter', function(){
      $(".comment").addClass("afterText");
    });
    });
   
  new Vue({
      el: "#wrapper",
      data:{
        newItem: '',
        item: [],
      },
      methods:{
        addItem  (){
        this.item.push(this.newItem);
          this.newItem = "";
        }
    }
    });
  </script>

    <body>
      <div ng-app="MyApp" ng-controller="AppCtrl">
          <!-- code Box-start -->
          <div class="codeheader" id="codeheader_python">Python</div>
            <div class="codebox">
              <pre>
colors.py

from colorsys import rgb_to_hsv

colors = dict((
((196, 2, 51), "RED"),
((255, 165, 0), "ORANGE"),
((255, 205, 0), "YELLOW"),
((0, 128, 0), "GREEN"),
((0, 0, 255), "BLUE"),
((127, 0, 255), "VIOLET"),
((255, 128, 255), "SWORD"),
((0, 0, 0), "BLACK"),
((255, 255, 255), "WHITE"),))

def to_hsv(color): 
  return rgb_to_hsv(*[x/255.0 for x in color])

def color_dist(c1, c2):
  return sum( (a-b)**2 for a,b in zip(to_hsv(c1),to_hsv(c2)) )

def min_color_diff(color_to_match, colors):
  return min((color_dist(color_to_match, test), colors[test]) for test in colors)

color_to_match = (254.74384236453201, 128.28571428571382,254.99507389162562)
print(min_color_diff(color_to_match, colors))

helpers.py

import time
import pyautogui as pag
import numpy as np

from colorsys import rgb_to_hsv

colors = dict((
  ((196, 2, 51), "RED"),
  ((255, 165, 0), "ORANGE"),
  ((255, 205, 0), "YELLOW"),
  ((0, 128, 0), "GREEN"),
  ((0, 0, 255), "BLUE"),
  ((127, 0, 255), "VIOLET"),
  ((0, 0, 0), "BLACK"),
  ((255, 255, 255), "WHITE"),
  ((255, 134, 255), "SWORD"),
  ((50, 50, 50), "BOMB"),
  ((120, 172, 102), "POISON"),
))

def to_hsv(color):
  return rgb_to_hsv(*[x/255.0 for x in color])

def color_dist(c1, c2):
  return sum((a-b)**2 for a,b in zip(rgb2lab(c1),rgb2lab(c2)))

def min_color_diff(color_to_match, colors=colors):
  return min((color_dist(color_to_match, test), colors[test]) for test in colors)

def click(x, y):
  pag.moveTo(x=x, y=y, duration=0.0)
  pag.mouseDown()
  # time.sleep(random.uniform(0.0101, 0.0299))
  pag.mouseUp()

def get_mouse_position():
  x, y = pag.position()
  positionStr = 'X: ' + str(x).rjust(4) + ' Y: ' + str(y).rjust(4)
  print(positionStr)

def rgb2lab ( inputColor ):
   num = 0
   RGB = [0, 0, 0]

   for value in inputColor :
       value = float(value) / 255

       if value > 0.04045 :
           value = ( ( value + 0.055 ) / 1.055 ) ** 2.4
       else :
           value = value / 12.92

       RGB[num] = value * 100
       num = num + 1

   XYZ = [0, 0, 0,]

   X = RGB [0] * 0.4124 + RGB [1] * 0.3576 + RGB [2] * 0.1805
   Y = RGB [0] * 0.2126 + RGB [1] * 0.7152 + RGB [2] * 0.0722
   Z = RGB [0] * 0.0193 + RGB [1] * 0.1192 + RGB [2] * 0.9505
   XYZ[ 0 ] = round( X, 4 )
   XYZ[ 1 ] = round( Y, 4 )
   XYZ[ 2 ] = round( Z, 4 )

   XYZ[ 0 ] = float( XYZ[ 0 ] ) / 95.047         # ref_X =  95.047   Observer= 2°, Illuminant= D65
   XYZ[ 1 ] = float( XYZ[ 1 ] ) / 100.0          # ref_Y = 100.000
   XYZ[ 2 ] = float( XYZ[ 2 ] ) / 108.883        # ref_Z = 108.883

   num = 0
   for value in XYZ :
       if value > 0.008856 :
           value = value ** ( 0.3333333333333333 )
       else :
           value = ( 7.787 * value ) + ( 16 / 116 )

       XYZ[num] = value
       num = num + 1

   Lab = [0, 0, 0]
   L = ( 116 * XYZ[ 1 ] ) - 16
   a = 500 * ( XYZ[ 0 ] - XYZ[ 1 ] )
   b = 200 * ( XYZ[ 1 ] - XYZ[ 2 ] )

   Lab [ 0 ] = round( L, 4 )
   Lab [ 1 ] = round( a, 4 )
   Lab [ 2 ] = round( b, 4 )

   return Lab

def countdown(t):
  while t:
    try:
      mins, secs = divmod(t, 60)
      timeformat = '{:02d}:{:02d}'.format(mins, secs)
      print(timeformat, end='\r')
      time.sleep(1)
      t -= 1
    except KeyboardInterrupt:
      print('Pass combat delay!')
      # bring_window()
      break

def piltocv(img, visualize=False):
  cv_img = np.array(img.convert('RGB'))
  # convert RGB to BGR
  cv_img = cv_img[:, :, ::-1].copy()

  if visualize:
    cv2.imshow('im', cv_img)
    if cv2.waitKey(1) & 0xFF == ord('q'):
      sys.exit(1)

  return cv_img

def find_histogram(clt):
  numLabels = np.arange(0, len(np.unique(clt.labels_)) + 1)
  (hist, _) = np.histogram(clt.labels_, bins=numLabels)

  hist = hist.astype("float")
  hist /= hist.sum()

  return hist

mouse.py

from helpers import *

while True:
  get_mouse_position()

run.py

import cv2, time, sys, random, mss
import numpy as np
import pyscreenshot
import pyautogui as pag
from sklearn.cluster import KMeans
from colorama import init, Fore, Back, Style
init(autoreset=True)

from helpers import *

pag.PAUSE = 0.01

fail_limit = 3

# bluestacks
left_icon_pos = {'left': 100, 'top': 540, 'width': 70, 'height': 70}
right_icon_pos = {'left': 250, 'top': 540, 'width': 70, 'height': 70}
left_button = [70, 680]
right_button = [355, 680]

# nox
# left_icon_pos = {'left': 170, 'top': 580, 'width': 80, 'height': 80}
# right_icon_pos = {'left': 355, 'top': 580, 'width': 80, 'height': 80}
# left_button = [133, 736]
# right_button = [476, 737]

icon_colors = {
  'BOMB': Fore.RED,
  'SWORD': Fore.MAGENTA,
  'POISON': Fore.GREEN,
  'JEWEL': Fore.CYAN,
}

def get_colors(img):
  img = img.reshape((img.shape[0] * img.shape[1], 3)) #represent as row*column,channel number
  clt = KMeans(n_clusters=3)
  clt.fit(img)

  hist = find_histogram(clt)

  dominant_colors = clt.cluster_centers_

  hist = sorted(hist, reverse=True)
  dominant_colors = [list(x) for _,x in sorted(zip(hist, dominant_colors))]
  

  pred = min_color_diff(dominant_colors[0])

  cli_color = Fore.WHITE
  if pred[1] in icon_colors:
    cli_color = icon_colors[pred[1]]

  print(hist, dominant_colors, '%s%s' % (cli_color, pred))

  if hist[0] > 0.4:
    pred = min_color_diff(dominant_colors[0])
    if pred[0] < 10: # color distance
      return pred[1]
  
  return False
      
  # for i, color in enumerate(dominant_colors):
  #   if hist[i] > 50:
      
  #   print(hist[i], min_color_diff(color))

  # print(hist)
  # print(dominant_colors)
  # print('=============')

  return {
    'colors': dominant_colors,
    'hist': hist
  }

####################################
####################################
####################################
if __name__ == "__main__":
  countdown(3)
  n_fails = 0
  n_frames = 0

  while True:
    n_frames += 1
    with mss.mss() as sct:
      left_img = np.array(sct.grab(left_icon_pos))[:,:,:3]
      right_img = np.array(sct.grab(right_icon_pos))[:,:,:3]
      # cv2.imshow('OpenCV/Numpy normal', np.concatenate((left_img, right_img), axis=1))
      # cv2.waitKey(1)
      # continue
      cv2.imwrite('img/%s.jpg' % (str(n_frames)), np.concatenate((left_img, right_img), axis=1))

      print(n_frames)
      left_icon = get_colors(left_img)
      right_icon = get_colors(right_img)

      if left_icon == 'SWORD' and (right_icon == 'BOMB' or right_icon == 'POISON'):
      # if left_icon == 'SWORD':
        print('CLICK LEFT!')
        click(x=left_button[0], y=left_button[1])
        n_fails = 0
      elif right_icon == 'SWORD' and (left_icon == 'BOMB' or left_icon == 'POISON'):
        print('CLICK RIGHT!')
        click(x=right_button[0], y=right_button[1])
        n_fails = 0
      elif left_icon == 'jewel' and right_icon == 'jewel':
        click(x=left_button[0], y=left_button[1])
        n_fails = 0
      else:
        print('i dont know')

        n_fails += 1
        if n_fails > fail_limit:
          print('failed %s times, terminate!' % (fail_limit))
          break

      # get_mouse_position()
      print('========================')
      time.sleep(0.06)

simple.py

import cv2, time, sys, random, mss
import numpy as np
import pyscreenshot
import pyautogui as pag
from sklearn.cluster import KMeans
from colorama import init, Fore, Back, Style
init(autoreset=True)

from helpers import *

pag.PAUSE = 0.001

fail_limit = 10

# bluestacks
left_icon_pos = {'left': 100, 'top': 540, 'width': 70, 'height': 70}
right_icon_pos = {'left': 250, 'top': 540, 'width': 70, 'height': 70}
left_button = [70, 680]
right_button = [355, 680]

# nox
# left_icon_pos = {'left': 170, 'top': 580, 'width': 80, 'height': 80}
# right_icon_pos = {'left': 355, 'top': 580, 'width': 80, 'height': 80}
# left_button = [133, 736]
# right_button = [476, 737]

icon_colors = {
  'BOMB': Fore.RED,
  'SWORD': Fore.MAGENTA,
  'POISON': Fore.GREEN,
  'JEWEL': Fore.CYAN,
}

def get_colors(img):
  img = img.reshape((img.shape[0] * img.shape[1], 3)) #represent as row*column,channel number
  clt = KMeans(n_clusters=2)
  clt.fit(img)

  hist = find_histogram(clt)

  dominant_colors = clt.cluster_centers_

  hist = sorted(hist, reverse=True)
  dominant_colors = [list(x) for _,x in sorted(zip(hist, dominant_colors))]
  

  pred = min_color_diff(dominant_colors[0])

  cli_color = Fore.WHITE
  if pred[1] in icon_colors:
    cli_color = icon_colors[pred[1]]

  print(hist, dominant_colors, '%s%s' % (cli_color, pred))

  if hist[0] > 0.5:
    if dominant_colors[0][0] < 55 and dominant_colors[0][1] < 55 and dominant_colors[0][2] < 55:
      return 'BOMB'
    elif dominant_colors[0][0] > 250 and dominant_colors[0][0] > 120 and dominant_colors[0][1] < 140 and dominant_colors[0][2] > 250:
      return 'SWORD'
      # 120, 172, 102
    elif dominant_colors[0][0] > 110 and dominant_colors[0][0] < 130 and dominant_colors[0][1] > 150 and dominant_colors[0][2] > 90 and dominant_colors[0][2] < 110:
      return 'POISON'
  
  return False

####################################
####################################
####################################
if __name__ == "__main__":
  countdown(3)
  n_fails = 0
  n_frames = 0

  while True:
    n_frames += 1
    with mss.mss() as sct:
      left_img = np.array(sct.grab(left_icon_pos))[:,:,:3]
      right_img = np.array(sct.grab(right_icon_pos))[:,:,:3]
      # cv2.imshow('OpenCV/Numpy normal', np.concatenate((left_img, right_img), axis=1))
      # cv2.waitKey(1)
      # continue
      # cv2.imwrite('img/%s.jpg' % (str(n_frames)), np.concatenate((left_img, right_img), axis=1))

      print(n_frames)
      left_icon = get_colors(left_img)
      right_icon = get_colors(right_img)

      if left_icon == 'SWORD' and (right_icon == 'BOMB' or right_icon == 'POISON'):
      # if left_icon == 'SWORD':
        print('CLICK LEFT!')
        click(x=left_button[0], y=left_button[1])
        n_fails = 0
      elif right_icon == 'SWORD' and (left_icon == 'BOMB' or left_icon == 'POISON'):
        print('CLICK RIGHT!')
        click(x=right_button[0], y=right_button[1])
        n_fails = 0
      elif left_icon == 'jewel' and right_icon == 'jewel':
        click(x=left_button[0], y=left_button[1])
        n_fails = 0
      else:
        print('i dont know')

        n_fails += 1
        if n_fails > fail_limit:
          print('failed %s times, terminate!' % (fail_limit))
          break

      # get_mouse_position()
      print('========================')
      time.sleep(0.04)

simplest.py

import cv2, time, sys, random, mss
import numpy as np
import pyautogui as pag
from colorama import init, Fore, Back, Style
init(autoreset=True)
from helpers import *

pag.PAUSE = 0.01

fail_limit = 10
initial_dalay = 0.08

# bluestacks
left_icon_pos = {'left': 100, 'top': 540, 'width': 70, 'height': 70}
right_icon_pos = {'left': 250, 'top': 540, 'width': 70, 'height': 70}
left_button = [70, 680]
right_button = [355, 680]

# nox
# left_icon_pos = {'left': 170, 'top': 580, 'width': 80, 'height': 80}
# right_icon_pos = {'left': 355, 'top': 580, 'width': 80, 'height': 80}
# left_button = [133, 736]
# right_button = [476, 737]

def get_colors(img):
  mean = np.mean(img, axis=(0, 1))

  result = False

  if mean[0] > 50 and mean[0] < 55 and mean[1] > 50 and mean[1] < 55 and mean[2] > 50 and mean[2] < 55:
    result = 'BOMB'
  elif mean[0] > 250 and mean[1] > 85 and mean[1] < 110 and mean[2] > 250:
    result = 'SWORD'
  elif mean[0] > 100 and mean[0] < 130 and mean[1] > 150 and mean[1] < 200 and mean[2] > 90 and mean[2] < 110:
    result = 'POISON'
  elif mean[0] > 210 and mean[0] < 230 and mean[1] > 200 and mean[1] < 225 and mean[2] > 120 and mean[2] < 135:
    result = 'JEWEL'

  return (result, mean)

####################################
####################################
####################################
if __name__ == "__main__":
  countdown(3)
  n_fails = 0
  n_frames = 0
  fever = False
  last_fever = time.time()
  last_icons = []

  while True:
    n_frames += 1

    if fever and time.time() - last_fever > 10:
      print('############### FEVER ################')
      click(x=left_button[0], y=left_button[1])

      if time.time() - fever > 5:
        fever = False
        last_fever = time.time()
      else:
        continue

    with mss.mss() as sct:
      left_img = np.array(sct.grab(left_icon_pos))[:,:,:3]
      right_img = np.array(sct.grab(right_icon_pos))[:,:,:3]
      # cv2.imshow('OpenCV/Numpy normal', np.concatenate((left_img, right_img), axis=1))
      # cv2.waitKey(1)
      # continue
      # cv2.imwrite('img/%s.jpg' % (str(n_frames)), np.concatenate((left_img, right_img), axis=1))

    # print(n_frames)
    left = get_colors(left_img)
    right = get_colors(right_img)
    left_icon = left[0]
    right_icon = right[0]

    if left_icon == 'SWORD' and (right_icon == 'BOMB' or right_icon == 'POISON'):
    # if left_icon == 'SWORD':
      print('TAP LEFT!')
      click(x=left_button[0], y=left_button[1])
      n_fails = 0
    elif right_icon == 'SWORD' and (left_icon == 'BOMB' or left_icon == 'POISON'):
      print('TAP RIGHT!')
      click(x=right_button[0], y=right_button[1])
      n_fails = 0
    elif left_icon == 'JEWEL' and right_icon == 'JEWEL':
      click(x=left_button[0], y=left_button[1])
      n_fails = 0
      fever = time.time()
      cv2.imwrite('img/fever_%s.jpg' % (str(n_frames)), np.concatenate((left_img, right_img), axis=1))
    else:
      # print('i dont know')
      n_fails += 1
      if n_fails > fail_limit:
        print('failed %s times, terminate!' % (fail_limit))
        break

    # get_mouse_position()
    # print('========================')
    time.sleep(initial_dalay)
</pre>
            </div>
            <!-- code Box-end -->
          <!-- 결과box-start  -->
          <div class = "result-box">
            <img class = "result1-img" src = "images/result8.jpg">
          </div>
        

          <!-- 결과box-end -->

          <!-- 댓글-start -->
          <section id="wrapper">
            <div class="box">
              <div class="row">
                <div class="col-6">
                  <div class="comment">
                <p v-for="items in item" v-text="items"></p>
                  </div>
                  </div>
                  </div>
              <div class="row">
                <div class="col-6">
              <textarea type="text" class="input" placeholder="Your Comment Here" v-model="newItem" @keyup.enter="addItem()"></textarea>
                  <button v-on:click="addItem()" class='btn-box' type="submit">Your Comment</button>
                </div>
              </div>
            </div>
          </section>
          <!-- 댓글-start -->
    </body>
</html>